services:
    back:
        build:
            context: ./Back/Presentation
        ports:
            - 81:81
            - 5002:5002
        #environment:
        #    - ASPNETCORE_URLS=http://+:5001;https://5002
        volumes:
            - './Back/Presentation/:/app/'
            - './Back/Domain:/Domain/'
        depends_on:
            - db
            - rabbit
            - minio
            - mongo
            - redis
        external_links:
            - rabbit:rabbitmq
            - db:database
            - redis:cache
            - mongo:meta
        networks:
            default:

    messagewriter:
        build: 
            context: ./Back/MessageReceiverAndDbWriter
        volumes:
            - './Back/MessageReceiverAndDbWriter/:/app/'
            - './Back/Domain:/Domain/'
        depends_on:
            - db
            - rabbit
        external_links:
            - rabbit:rabbitmq
            - db:database
        networks:
            default:

    front:
        build:
            context: ./Front
        ports:
            - 80:80
        environment:
            - PORT=80
        volumes:
            - './Front/:/app/'
        depends_on:
            - back
        networks:
            default:

    db:
        image: postgres:14.5
        environment:
            POSTGRES_DB: "testdb"
            POSTGRES_USER: "testuser"
            POSTGRES_PASSWORD: "testpass"
            PGDATA: "/var/lib/postgresql/data/pgdata"
        ports:
            - 5432:5432
        networks:
            default:

    structurizr:
        image: structurizr/lite
        ports:
            - 8001:8080
        volumes:
            - './structurizr:/usr/local/structurizr/'

    rabbit:
        image: rabbitmq:3-management
        ports:
            - 5671:5671
            - 5672:5672
            - 15672:15672
        networks:
            default:
                
    minio:
        image: minio/minio
        command: server --console-address ":9001" /data/
        ports:
            - 9000:9000
            - 9001:9001
        environment:
            MINIO_ROOT_USER: qweqweqwe
            MINIO_ROOT_PASSWORD: qweqweqwe
        networks:
            default:
                
    mongo:
        image: mongo
        ports:
            - 27017:27017
        environment:
            - MONGO_INITDB_ROOT_USERNAME=qwe
            - MONGO_INITDB_ROOT_PASSWORD=qwe
            - MONGO_INITDB_DATABASE=files
    
    redis:
        image: redis
        ports:
            - 6379:6379
        